const { 
    Client, 
    GatewayIntentBits, 
    Partials, 
    EmbedBuilder, 
    ActionRowBuilder, 
    ButtonBuilder, 
    ButtonStyle, 
    SlashCommandBuilder, 
    PermissionFlagsBits, 
    REST, 
    Routes,
    ActivityType,
    ChannelType,
    ModalBuilder, 
    TextInputBuilder, 
    TextInputStyle
} = require('discord.js');
const ms = require('ms'); 

// --- ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏ã‡∏µ‡∏°‡πà‡∏≠‡∏ô ---
const TOKEN = process.env.TOKEN || '‡πÉ‡∏™‡πà_TOKEN_‡∏ö‡∏≠‡∏ó_‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ'; 
const CLIENT_ID = process.env.CLIENT_ID || '‡πÉ‡∏™‡πà_CLIENT_ID_‡∏ö‡∏≠‡∏ó_‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ'; 
const OWNER_ID = process.env.OWNER_ID || '‡πÉ‡∏™‡πà_‡πÑ‡∏≠‡∏î‡∏µ_‡∏ã‡∏µ‡∏°‡πà‡∏≠‡∏ô_‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ'; 

const db = {
    users: {}, 
    config: { antiLink: [] }
};

// --- üõ°Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏±‡∏ô‡∏ö‡∏≠‡∏ó‡∏ï‡∏≤‡∏¢ ---
process.on('unhandledRejection', error => console.error('Unhandled Rejection:', error));
process.on('uncaughtException', error => console.error('Uncaught Exception:', error));

const client = new Client({
    intents: [
        GatewayIntentBits.Guilds,
        GatewayIntentBits.GuildMembers, 
        GatewayIntentBits.GuildMessages,
        GatewayIntentBits.MessageContent,
        GatewayIntentBits.GuildVoiceStates
    ],
    partials: [Partials.Channel, Partials.Message, Partials.Reaction]
});

// --- üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á Slash Command ---
const commands = [
    new SlashCommandBuilder().setName('setup-verify').setDescription('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ Panel ‡∏£‡∏±‡∏ö‡∏¢‡∏®').setDefaultMemberPermissions(PermissionFlagsBits.Administrator).addRoleOption(o => o.setName('role').setDescription('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏®').setRequired(true)),
    new SlashCommandBuilder().setName('setup-ticket').setDescription('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ Panel ‡∏ï‡∏±‡πã‡∏ß‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô').setDefaultMemberPermissions(PermissionFlagsBits.Administrator),
    new SlashCommandBuilder().setName('setup-stats').setDescription('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å').setDefaultMemberPermissions(PermissionFlagsBits.Administrator),
    new SlashCommandBuilder().setName('announce').setDescription('üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£').setDefaultMemberPermissions(PermissionFlagsBits.Administrator).addStringOption(o => o.setName('title').setDescription('‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠').setRequired(true)).addStringOption(o => o.setName('message').setDescription('‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤').setRequired(true)).addAttachmentOption(o => o.setName('image').setDescription('‡∏£‡∏π‡∏õ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö')),
    new SlashCommandBuilder().setName('clear').setDescription('üßπ ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß)').setDefaultMemberPermissions(PermissionFlagsBits.Administrator).addIntegerOption(o => o.setName('amount').setDescription('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (1-100)').setMinValue(1).setMaxValue(100).setRequired(true)),
    new SlashCommandBuilder().setName('setup-tell-dm').setDescription('üíå ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ Panel ‡∏ù‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å DM').setDefaultMemberPermissions(PermissionFlagsBits.Administrator),
    new SlashCommandBuilder().setName('giveaway').setDescription('üéâ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏à‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•')
        .setDefaultMemberPermissions(PermissionFlagsBits.Administrator)
        .addStringOption(o => o.setName('prize').setDescription('‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (‡∏Ñ‡∏µ‡∏¢‡πå, ‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå‡∏ã‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô, ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏®)').setRequired(true))
        .addStringOption(o => o.setName('duration').setDescription('‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô 1m, 1h)').setRequired(true))
        .addIntegerOption(o => o.setName('winners').setDescription('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞').setMinValue(1).setRequired(true))
        .addChannelOption(o => o.setName('log_channel').setDescription('‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞').addChannelTypes(ChannelType.GuildText).setRequired(true)),
    new SlashCommandBuilder().setName('setup-antilink').setDescription('üõ°Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå').setDefaultMemberPermissions(PermissionFlagsBits.Administrator).addChannelOption(o => o.setName('channel').setDescription('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á').addChannelTypes(ChannelType.GuildText).setRequired(true)),
    new SlashCommandBuilder().setName('setup-level').setDescription('üìä ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ Panel ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏•‡πÄ‡∏ß‡∏•').setDefaultMemberPermissions(PermissionFlagsBits.Administrator).addRoleOption(o => o.setName('lv20').setRequired(true)).addRoleOption(o => o.setName('lv40').setRequired(true)).addRoleOption(o => o.setName('lv60').setRequired(true)).addRoleOption(o => o.setName('lv80').setRequired(true)).addRoleOption(o => o.setName('lv100').setRequired(true))
].map(command => command.toJSON());

const rest = new REST({ version: '10' }).setToken(TOKEN);

client.once('ready', async () => {
    console.log(`‚úÖ ‡∏ô‡πâ‡∏≠‡∏á‡∏õ‡∏≤‡∏¢ (Swift Hub Core) ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞!`);
    const statusMessages = ["‚öôÔ∏è Swift Hub Core | Active", "üëë Powered by Zemon ≈πx", "üíñ ‡∏ô‡πâ‡∏≠‡∏á‡∏õ‡∏≤‡∏¢‡∏£‡∏±‡∏Å‡∏û‡∏µ‡πà‡∏ã‡∏µ‡∏°‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î~", "üöÄ xSwift Hub Community"];
    let currentIndex = 0;
    setInterval(() => {
        client.user.setPresence({ activities: [{ name: statusMessages[currentIndex], type: ActivityType.Playing }], status: 'online' });
        currentIndex = (currentIndex + 1) % statusMessages.length;
    }, 3000); 

    try { await rest.put(Routes.applicationCommands(CLIENT_ID), { body: commands }); } catch (e) { console.error(e); }
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô XP 
function addXP(userId, amount) {
    if (!db.users[userId]) db.users[userId] = { xp: 0, level: 1, lastMsg: 0 };
    db.users[userId].xp += amount;
    let nextLevelXP = db.users[userId].level * 500; 
    if (db.users[userId].xp >= nextLevelXP && db.users[userId].level < 100) {
        db.users[userId].level++;
        db.users[userId].xp = 0;
        return true; 
    }
    return false;
}

client.on('messageCreate', async message => {
    if (message.author.bot || !message.guild) return;
    if (Date.now() - (db.users[message.author.id]?.lastMsg || 0) > 60000) {
        const leveledUp = addXP(message.author.id, Math.floor(Math.random() * 6) + 5);
        if (!db.users[message.author.id]) db.users[message.author.id] = { xp: 0, level: 1, lastMsg: 0 };
        db.users[message.author.id].lastMsg = Date.now();
        if (leveledUp) {
            message.channel.send(`üéä ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏∞‡∏Ñ‡∏∏‡∏ì <@${message.author.id}>! ‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏≠‡∏±‡∏õ‡πÄ‡∏õ‡πá‡∏ô **Lv.${db.users[message.author.id].level}** ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡πâ‡∏≤‡∏≤ ‡πÄ‡∏Å‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏•‡∏¢! üíñ‚ú®`).then(m => setTimeout(() => m.delete().catch(()=>{}), 10000));
        }
    }
    if (db.config.antiLink.includes(message.channelId)) {
        const linkRegex = /(https?:\/\/[^\s]+)/g;
        if (linkRegex.test(message.content)) {
            await message.delete().catch(() => {});
            const warn = await message.channel.send({ content: `‚ùå **‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Ñ‡πà‡∏∞‡∏Ñ‡∏∏‡∏ì <@${message.author.id}>!** ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏∏‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡∏õ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ô‡πâ‡∏≤~ üõ°Ô∏è‚ú®` });
            setTimeout(() => warn.delete().catch(() => {}), 10000); 
        }
    }
});

client.on('interactionCreate', async interaction => {
    
    if (interaction.isChatInputCommand()) {
        if (interaction.user.id !== OWNER_ID) return interaction.reply({ content: '‚ùå ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ã‡∏µ‡∏°‡πà‡∏≠‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡πà‡∏∞!', ephemeral: true });

        if (interaction.commandName === 'clear') {
            const amt = interaction.options.getInteger('amount');
            await interaction.channel.bulkDelete(amt, true);
            return interaction.reply({ content: `üßπ ‡∏Å‡∏ß‡∏≤‡∏î‡∏ñ‡∏π‡πÅ‡∏ä‡∏ó‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ **${amt}** ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°! ‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÉ‡∏ô‡∏û‡∏£‡∏¥‡∏ö‡∏ï‡∏≤‡πÄ‡∏•‡∏¢ ‚ú®`, ephemeral: true });
        }

        if (interaction.commandName !== 'giveaway') await interaction.deferReply({ ephemeral: true });

        if (interaction.commandName === 'setup-verify') {
            const role = interaction.options.getRole('role');
            const embed = new EmbedBuilder().setColor('#FF69B4').setTitle('‚ú® ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå ‚ú®').setDescription(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÅ‡∏´‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏õ‡∏±‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞! üéâ\n\n**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå:**\n1Ô∏è‚É£ ‡∏≠‡πà‡∏≤‡∏ô‡∏Å‡∏é‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢\n2Ô∏è‚É£ ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô\n3Ô∏è‚É£ ‡∏£‡∏±‡∏ö‡∏¢‡∏® <@&${role.id}> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢\n\n*‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏ô‡∏∏‡∏Å‡∏ô‡∏∞‡∏Ñ‡∏∞! üíñ*`).setImage('https://media.discordapp.net/attachments/1079089989930745917/1105497258381594684/standard.gif');
            const row = new ActionRowBuilder().addComponents(new ButtonBuilder().setCustomId(`verify_button_${role.id}`).setLabel('‡∏£‡∏±‡∏ö‡∏¢‡∏®‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏¥‡∏™').setEmoji('‚úÖ').setStyle(ButtonStyle.Success));
            await interaction.channel.send({ embeds: [embed], components: [row] });
            await interaction.editReply('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡∏¢‡∏®‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡πà‡∏∞!');
        }

        if (interaction.commandName === 'giveaway') {
            const prize = interaction.options.getString('prize');
            const dur = interaction.options.getString('duration');
            const wins = interaction.options.getInteger('winners');
            const logCh = interaction.options.getChannel('log_channel');

            const embed = new EmbedBuilder().setColor('#FFD700').setTitle('üéä ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° GIVEAWAY ‚ú®').setDescription(`‡∏°‡∏≤‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô! ‚ú®\n\nüéÅ **‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•:** **‡∏õ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô DM)**\nüë• **‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ:** **${wins} ‡∏ó‡πà‡∏≤‡∏ô**\n‚è≥ **‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:** **${dur}**\n\n*‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ô‡πâ‡∏≤ üíñ*`);
            const row = new ActionRowBuilder().addComponents(new ButtonBuilder().setCustomId('join_giveaway').setLabel('‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°').setEmoji('üéÅ').setStyle(ButtonStyle.Primary));
            const gmsg = await interaction.channel.send({ embeds: [embed], components: [row] });
            await interaction.reply({ content: '‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏à‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞!', ephemeral: true });

            let entry = [];
            const col = gmsg.createMessageComponentCollector({ time: ms(dur) });
            col.on('collect', i => {
                if (entry.includes(i.user.id)) return i.reply({ content: '‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏Å‡∏î‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡πâ‡∏≤! üåü', ephemeral: true });
                entry.push(i.user.id);
                i.reply({ content: '‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡∏ô‡πâ‡∏≤~ üíñ', ephemeral: true });
            });

            col.on('end', async () => {
                if (entry.length === 0) return gmsg.edit({ content: '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏•‡∏¢‡∏á‡πà‡∏≤...', embeds: [], components: [] });
                const winners = entry.sort(() => 0.5 - Math.random()).slice(0, wins);
                const expiry = Date.now() + (10 * 60 * 60 * 1000);

                const resultEmbed = new EmbedBuilder().setColor('#FFD700').setTitle('üéä ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ! üéä').setDescription(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ô‡∏∞‡∏Ñ‡∏∞!\nüèÜ **‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞:** ${winners.map(w => `<@${w}>`).join(', ')}\n\n‚ö†Ô∏è **‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:** ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 10 ‡∏ä‡∏°. ‡∏°‡∏¥‡∏â‡∏∞‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏°‡∏Ü‡∏∞‡∏Ñ‡πà‡∏∞!\n*(‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ DM ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ô‡∏Ç‡πÇ‡∏°‡∏¢‡∏ô‡πâ‡∏≤)*`);
                const claimRow = new ActionRowBuilder().addComponents(new ButtonBuilder().setCustomId(`claim_${expiry}_${prize}`).setLabel('üéÅ ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà').setStyle(ButtonStyle.Success));
                await gmsg.edit({ content: `üéä ‡∏à‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞! üéâ`, embeds: [resultEmbed], components: [claimRow] });

                // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡πâ‡∏≠‡∏á Log (üîí ‡∏õ‡∏¥‡∏î‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ñ‡∏≤‡∏ß‡∏£‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏ä‡∏ó)
                const logEmbed = new EmbedBuilder().setColor('#00FF00').setTitle('üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°!').setDescription(`üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ö ${winners.map(w => `<@${w}>`).join(', ')}\n‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: ||üîí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô DM ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô|| ‚ú®\n\nüìå **‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô DM ‡∏ô‡∏∞‡∏Ñ‡∏∞!**`).setTimestamp();
                await logCh.send({ content: winners.map(w => `<@${w}>`).join(' '), embeds: [logEmbed] });
            });
        }
        
        if (interaction.commandName === 'setup-antilink') {
            const ch = interaction.options.getChannel('channel');
            if (!db.config.antiLink.includes(ch.id)) db.config.antiLink.push(ch.id);
            await interaction.editReply(`üõ°Ô∏è ‡∏´‡πâ‡∏≠‡∏á <#${ch.id}> ‡∏Å‡∏±‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!`);
        }
    }

    if (interaction.isButton()) {
        if (interaction.customId.startsWith('claim_')) {
            const parts = interaction.customId.split('_');
            const expiry = parseInt(parts[1]);
            const prize = parts.slice(2).join('_');
            const isLink = prize.includes('http');

            if (Date.now() > expiry) return interaction.reply({ content: `‚ùå **‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞!** ‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡πâ‡∏≤ ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏°‡∏Ü‡∏∞‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ ü•∫`, ephemeral: true });
            if (!interaction.message.embeds[0].description.includes(interaction.user.id)) return interaction.reply({ content: `‚ùå ‡∏≠‡∏∏‡πä‡∏¢! ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ô‡πâ‡∏≤‡∏≤ ü§≠`, ephemeral: true });

            await interaction.reply({ content: `üéâ **‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏∞!** ‡∏õ‡∏≤‡∏¢‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏ó‡∏≤‡∏á **DM** ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞! üíñ\n*(‡πÉ‡∏ô DM ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå‡πÑ‡∏î‡πâ‡∏ô‡πâ‡∏≤)*`, ephemeral: true });
            
            try {
                const dmEmbed = new EmbedBuilder().setColor('#FFD700').setTitle('üéä ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• GIVEAWAY ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß! üéä')
                    .setDescription(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞! ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏≠:\n\n${isLink ? `üîó **‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•:** (‡∏à‡∏¥‡πâ‡∏°‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞)` : `üéÅ **‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•:** \`${prize}\` (‡∏à‡∏¥‡πâ‡∏°‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!)`}\n\n*‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏±‡∏ö xSwift Hub ‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡∏£‡∏±‡∏Å‡∏ô‡πâ‡∏≤‡∏≤~ üíñ*`);
                
                const dmRow = new ActionRowBuilder();
                if (isLink) {
                    dmRow.addComponents(new ButtonBuilder().setLabel('üîó ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•').setStyle(ButtonStyle.Link).setURL(prize));
                }

                await interaction.user.send({ embeds: [dmEmbed], components: isLink ? [dmRow] : [] });

                const roleObj = interaction.guild.roles.cache.find(r => r.name === prize || r.id === prize.replace(/[<@&>]/g, ''));
                if (roleObj) await interaction.member.roles.add(roleObj).catch(()=>{});
            } catch (e) { console.log('‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏õ‡∏¥‡∏î DM'); }
        }

        if (interaction.customId.startsWith('verify_button_')) {
            const rId = interaction.customId.split('_')[2];
            if (interaction.member.roles.cache.has(rId)) return interaction.reply({ content: '‚ùå **‡∏≠‡∏∏‡πä‡∏¢! ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏®‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡πâ‡∏≤‡∏≤** ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô‡πÑ‡∏ß‡πâ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡πâ‡∏≤ üíñ‚ú®', ephemeral: true });
            const role = interaction.guild.roles.cache.get(rId);
            if (role) {
                await interaction.member.roles.add(role).then(() => interaction.reply({ content: '‚úÖ **‡∏¢‡∏¥‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!** ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏ô‡∏∞‡∏Ñ‡∏∞ üíñ', ephemeral: true })).catch(() => interaction.reply({ content: '‚ùå ‡∏õ‡∏≤‡∏¢‡∏¢‡∏®‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏∞', ephemeral: true }));
            }
        }
        
        if (interaction.customId === 'open_ticket') {
            const cName = `ticket-${interaction.user.username.toLowerCase().replace(/[^a-z0-9]/g, '')}`;
            if (interaction.guild.channels.cache.find(c => c.name === cName)) return interaction.reply({ content: '‚ùå ‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞‡∏Ñ‡∏∞!', ephemeral: true });
            const ch = await interaction.guild.channels.create({ name: cName, type: ChannelType.GuildText, permissionOverwrites: [{ id: interaction.guild.id, deny: [PermissionFlagsBits.ViewChannel] }, { id: interaction.user.id, allow: [PermissionFlagsBits.ViewChannel] }, { id: OWNER_ID, allow: [PermissionFlagsBits.ViewChannel] }, { id: client.user.id, allow: [PermissionFlagsBits.ViewChannel] }] });
            const emb = new EmbedBuilder().setColor('#00FF00').setTitle(`üé´ ‡∏®‡∏π‡∏ô‡∏¢‡πå‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ${interaction.user.tag}`).setDescription(`‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô <@${OWNER_ID}> ‡∏à‡∏∞‡∏£‡∏µ‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡πà‡∏∞! üõ°Ô∏è`).setTimestamp();
            const btn = new ActionRowBuilder().addComponents(new ButtonBuilder().setCustomId('close_ticket').setLabel('‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡πã‡∏ß‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠').setStyle(ButtonStyle.Danger).setEmoji('üîí'));
            await ch.send({ embeds: [emb], components: [btn] });
            await interaction.reply({ content: `‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞! üëâ <#${ch.id}>`, ephemeral: true });
        }
        
        if (interaction.customId === 'close_ticket') {
            await interaction.reply('üîí ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏Ñ‡πà‡∏∞...');
            setTimeout(() => interaction.channel.delete().catch(() => {}), 5000);
        }
    }
});

client.login(TOKEN);
